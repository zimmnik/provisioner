mkdir conf && cd conf

cat << 'EOF' >> sshd_config
usepam no
loglevel INFO
compression no
disableforwarding yes
permitrootlogin prohibit-password
gssapiauthentication no
pubkeyauthentication yes
kerberosauthentication no
passwordauthentication no
hostbasedauthentication no
kbdinteractiveauthentication no
challengeresponseauthentication no
hostkey /etc/ssh/ssh_host_rsa_key
hostkey /etc/ssh/ssh_host_ecdsa_key
hostkey /etc/ssh/ssh_host_ed25519_key
authorizedkeysfile /etc/ssh/authorized_keys
chrootdirectory /mnt
subsystem sftp internal-sftp
forcecommand internal-sftp
EOF

for TYPE in {rsa,ecdsa,ed25519}; do ssh-keygen -N '' -t ${TYPE} -f ssh_host_${TYPE}_key; done
time ssh-keygen -M 127 -b 2048 -W 2 -G numbers 
time ssh-keygen -f numbers -T moduli
rm numbers

cd .. && chmod og-rwx conf/

cat << 'EOF' >> Dockerfile
FROM centos:8
MAINTAINER Semyon Vasilkov <docker@zimmnik.ru>
LABEL Description="OpenSSH SFTP server" Version="1"
USER root
RUN yum -y install openssh-server && \
    yum clean all && \
    rm -rf /var/cache/yum && \
    usermod -U root
EXPOSE 22
CMD ["/usr/sbin/sshd", "-e", "-D"]
EOF

docker build -t openssh-sftp-server .
docker run --name sftp_backup -p 2222:22 -v $(pwd)/conf:/etc/ssh:Z,ro -d openssh-sftp-server

sftp -i ~/.ssh/id_rsa_zorg sftp://root@localhost:2222
sudo yum install fuse-sshfs && \
sshfs root@localhost:/ ~/temp -p 2222 -o IdentityFile=~/.ssh/id_rsa
